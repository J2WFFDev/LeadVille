<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Working Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .test-box { 
            background: white; 
            padding: 20px; 
            margin: 10px 0; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .device { 
            background: lightblue; 
            padding: 10px; 
            margin: 5px 0; 
            border-radius: 4px; 
            cursor: grab;
            user-select: none;
        }
        .device:active { cursor: grabbing; }
        .device.dragging { opacity: 0.5; }
        .target { 
            background: lightgreen; 
            padding: 15px; 
            margin: 10px 0; 
            border: 2px dashed #333; 
            border-radius: 4px;
            min-height: 40px;
            text-align: center;
        }
        .target.drag-over { background: yellow; }
        .status { padding: 10px; background: #e8f4f8; border-radius: 4px; margin: 10px 0; }
        .error { background: #ffe6e6; color: red; }
        .success { background: #e6ffe6; color: green; }
    </style>
</head>
<body>
    <h1>🧪 Minimal Drag-Drop Test</h1>
    <p><strong>Status:</strong> <span id="status">Testing if page loads...</span></p>

    <div class="test-box">
        <h3>Devices (drag these)</h3>
        <div class="device" draggable="true" data-device="AMG Timer">⏱️ AMG Timer (60:09:C3:1F:DC:1A)</div>
        <div class="device" draggable="true" data-device="BT50-1">📡 BT50 Sensor 1 (EA:18:3D:6D:BA:E5)</div>
        <div class="device" draggable="true" data-device="BT50-2">📡 BT50 Sensor 2 (DB:10:38:B6:13:6B)</div>
    </div>

    <div class="test-box">
        <h3>Targets (drop here)</h3>
        <div class="target" data-target="1">🎯 Target 1</div>
        <div class="target" data-target="2">🎯 Target 2</div>
        <div class="target" data-target="3">🎯 Target 3</div>
    </div>

    <div class="test-box">
        <h3>Event Log</h3>
        <div id="log" style="height: 150px; overflow-y: auto; background: #f9f9f9; padding: 10px; border: 1px solid #ddd;"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        // Test if JavaScript is working
        document.getElementById('status').textContent = 'JavaScript is working!';
        document.getElementById('status').className = 'status success';

        const log = document.getElementById('log');

        function logEvent(msg) {
            const time = new Date().toLocaleTimeString();
            log.innerHTML += `[${time}] ${msg}<br>`;
            log.scrollTop = log.scrollHeight;
            console.log(msg);
        }

        function clearLog() {
            log.innerHTML = '';
        }

        let draggedData = null;

        // Add drag events to devices
        document.querySelectorAll('.device').forEach(device => {
            device.addEventListener('dragstart', (e) => {
                const deviceName = device.getAttribute('data-device');
                draggedData = deviceName;
                device.classList.add('dragging');
                logEvent(`🖱️ Started dragging: ${deviceName}`);
            });

            device.addEventListener('dragend', (e) => {
                device.classList.remove('dragging');
                logEvent(`🖱️ Finished dragging`);
            });
        });

        // Add drop events to targets
        document.querySelectorAll('.target').forEach(target => {
            target.addEventListener('dragover', (e) => {
                e.preventDefault(); // Required to allow drop
            });

            target.addEventListener('dragenter', (e) => {
                target.classList.add('drag-over');
                const targetNum = target.getAttribute('data-target');
                logEvent(`🎯 Hovering over Target ${targetNum}`);
            });

            target.addEventListener('dragleave', (e) => {
                target.classList.remove('drag-over');
            });

            target.addEventListener('drop', (e) => {
                e.preventDefault();
                target.classList.remove('drag-over');
                
                const targetNum = target.getAttribute('data-target');
                
                if (draggedData) {
                    logEvent(`✅ DROPPED: ${draggedData} on Target ${targetNum}`);
                    
                    // Show success message
                    const successDiv = document.createElement('div');
                    successDiv.className = 'status success';
                    successDiv.textContent = `SUCCESS: ${draggedData} assigned to Target ${targetNum}`;
                    target.appendChild(successDiv);
                    
                    // Remove success message after 3 seconds
                    setTimeout(() => {
                        if (successDiv.parentNode) {
                            successDiv.parentNode.removeChild(successDiv);
                        }
                    }, 3000);
                } else {
                    logEvent(`❌ No device data for drop`);
                }
            });
        });

        // Test API connectivity
        setTimeout(async () => {
            logEvent('🌐 Testing API connectivity...');
            const API_BASE = `${window.location.protocol}//${window.location.hostname}:8001`;
            
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                if (response.ok) {
                    const data = await response.json();
                    logEvent(`✅ API is working: ${JSON.stringify(data)}`);
                } else {
                    logEvent(`⚠️ API returned status ${response.status}`);
                }
            } catch (error) {
                logEvent(`❌ API error: ${error.message}`);
            }
        }, 1000);

        logEvent('📄 Page loaded successfully');
        logEvent('🎯 Try dragging a device to a target!');
    </script>
</body>
</html>